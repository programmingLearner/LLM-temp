import torch
import matplotlib.pyplot as plt

# Assuming `activations` is a dictionary storing the layer outputs
for layer_name, activation in activations.items():
    if not isinstance(activation, torch.Tensor):
        # Handle non-tensor activations (e.g., tuple)
        for i, act in enumerate(activation):
            if isinstance(act, torch.Tensor) and act.dim() > 1: 
                plt.figure()
                plt.title(f"{layer_name} - Index {i}")
                plt.hist(act.flatten().cpu().numpy(), bins=100, log=True)
                plt.savefig(f"{layer_name}_index_{i}.png")
    else:
        # Handle tensor activations
        if activation.dim() > 1:
            plt.figure()
            plt.title(layer_name)
            plt.hist(activation.flatten().cpu().numpy(), bins=100, log=True)
            plt.savefig(f"{layer_name}.png")
